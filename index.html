<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#6B46C1">
    <meta name="description" content="NeuroThrive Daily - Your neurodivergent support companion">

    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="NeuroThrive">

    <title>NeuroThrive Daily</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Icon using emoji -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß†</text></svg>">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6B46C1;
            --secondary: #4CAF50;
            --accent: #FFB300;
            --warning: #FF5252;
            --background: #F5F5F5;
            --surface: #FFFFFF;
            --text: #212121;
            --text-secondary: #757575;
            --success: #4CAF50;
            --error: #F44336;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--background);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .install-button {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            display: none;
            transition: all 0.3s;
        }

        .install-button:hover {
            background: white;
            color: var(--primary);
        }

        /* Navigation */
        .nav-tabs {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: sticky;
            top: 60px;
            z-index: 90;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .nav-tabs-inner {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-tab {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .nav-tab:hover {
            background: rgba(107, 70, 193, 0.05);
        }

        /* Main Content */
        .content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
            padding-bottom: 80px;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        /* Dashboard Charts */
        .chart-container {
            position: relative;
            height: 200px;
            margin: 1rem 0;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            height: 100%;
            gap: 0.5rem;
            padding: 1rem 0;
        }

        .bar {
            flex: 1;
            background: linear-gradient(to top, var(--primary), var(--accent));
            border-radius: 8px 8px 0 0;
            min-height: 20px;
            position: relative;
            transition: all 0.3s;
            cursor: pointer;
        }

        .bar:hover {
            opacity: 0.8;
            transform: translateY(-5px);
        }

        .bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: bold;
            font-size: 0.85rem;
            color: var(--primary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .stat-box {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Energy Meter */
        .energy-meter {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .energy-bar {
            flex: 1;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }

        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--error), var(--accent), var(--success));
            border-radius: 15px;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .quick-action {
            background: var(--surface);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-action:hover {
            background: var(--primary);
            color: white;
        }

        .quick-action-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        /* Meal Planning */
        .meal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .meal-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.3s;
        }

        .meal-card:hover {
            border-color: var(--primary);
        }

        .meal-time {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .meal-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .meal-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .meal-history {
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e0e0e0;
        }

        .meal-history-item {
            font-size: 0.85rem;
            color: var(--text-secondary);
            padding: 0.25rem 0;
        }

        /* Journal Win Parser */
        .win-input {
            width: 100%;
            min-height: 150px;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .win-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .win-preview {
            background: rgba(107, 70, 193, 0.05);
            border: 2px dashed var(--primary);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .win-item {
            display: flex;
            align-items: start;
            gap: 0.5rem;
            padding: 0.5rem 0;
        }

        .win-bullet {
            color: var(--success);
            font-size: 1.2rem;
        }

        .win-category {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }

        /* Mood Tracking */
        .mood-tracker {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .mood-time {
            flex: 1;
            min-width: 150px;
            text-align: center;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mood-time.completed {
            border-color: var(--success);
            background: rgba(76, 175, 80, 0.05);
        }

        .mood-time:hover {
            border-color: var(--primary);
        }

        .mood-emoji {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .mood-label {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .mood-value {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .mood-time-range {
            color: var(--text-secondary);
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        /* Routine Timers */
        .timer-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .timer-info {
            flex: 1;
        }

        .timer-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .timer-duration {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .timer-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .timer-display {
            font-size: 1.5rem;
            font-weight: bold;
            font-family: monospace;
            min-width: 80px;
            text-align: right;
        }

        .timer-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .timer-button:hover {
            background: var(--primary);
            color: white;
        }

        .timer-button.active {
            background: var(--warning);
            border-color: var(--warning);
            color: white;
        }

        /* Box Breathing Cycle Counter */
        .breathing-cycle {
            background: linear-gradient(135deg, rgba(107, 70, 193, 0.1), rgba(76, 175, 80, 0.1));
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .breathing-step {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            margin: 0.5rem 0;
            background: white;
            border-radius: 8px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .breathing-step.active {
            border-color: var(--success);
            background: rgba(76, 175, 80, 0.1);
            transform: scale(1.02);
        }

        .breathing-step-name {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .breathing-countdown {
            font-size: 2rem;
            font-weight: bold;
            color: var(--success);
            min-width: 50px;
            text-align: center;
        }

        .breathing-counter {
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .breathing-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
        }

        /* Hard Stop Banner */
        .hard-stop-banner {
            background: var(--warning);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .hard-stop-icon {
            font-size: 2rem;
        }

        .hard-stop-text {
            flex: 1;
        }

        .hard-stop-title {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 0.25rem;
        }

        .acknowledge-button {
            background: white;
            color: var(--warning);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .acknowledge-button:hover {
            transform: scale(1.05);
        }

        /* Imposter Counter */
        .imposter-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: border-color 0.3s;
        }

        .imposter-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .counter-facts {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid var(--success);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .fact-item {
            display: flex;
            align-items: start;
            gap: 0.5rem;
            padding: 0.5rem 0;
        }

        .fact-icon {
            color: var(--success);
        }

        .believability-scale {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        .scale-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #e0e0e0;
            background: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .scale-button:hover {
            border-color: var(--primary);
        }

        .scale-button.selected {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Journal Entry Display */
        .journal-entries {
            margin-top: 1rem;
        }

        .journal-entry {
            background: rgba(107, 70, 193, 0.05);
            border-left: 4px solid var(--primary);
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .journal-entry-date {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .journal-entry-content {
            margin-bottom: 0.5rem;
        }

        .journal-entry-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .keyword-tag {
            background: var(--accent);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
        }

        .search-bar {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .search-bar:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            padding: 0.5rem 0;
            z-index: 100;
        }

        .bottom-nav-item {
            flex: 1;
            padding: 0.5rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            transition: color 0.3s;
        }

        .bottom-nav-item.active {
            color: var(--primary);
        }

        .bottom-nav-icon {
            font-size: 1.5rem;
        }

        .bottom-nav-label {
            font-size: 0.75rem;
        }

        /* Success Messages */
        .success-message {
            background: var(--success);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
            animation: slideIn 0.5s;
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-tabs {
                top: 56px;
            }

            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }

            .mood-tracker {
                flex-direction: column;
            }

            .mood-time {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* PWA Install Prompt */
        .install-prompt {
            position: fixed;
            bottom: 80px;
            left: 1rem;
            right: 1rem;
            background: white;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 200;
            display: none;
            animation: slideUp 0.5s;
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .install-prompt-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .install-prompt-icon {
            font-size: 3rem;
        }

        .install-prompt-text {
            flex: 1;
        }

        .install-prompt-title {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .install-prompt-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .install-accept {
            flex: 1;
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }

        .install-decline {
            flex: 1;
            background: #e0e0e0;
            color: var(--text);
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
        }

        /* Gratitude Section */
        .gratitude-entry {
            background: rgba(255, 179, 0, 0.05);
            border-left: 4px solid var(--accent);
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .gratitude-text {
            margin-bottom: 0.5rem;
        }

        .gratitude-time {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        /* Button Styles */
        .button-primary {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
        }

        .button-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(107, 70, 193, 0.3);
        }

        .button-primary:active {
            transform: translateY(0);
        }

        .button-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
        }

        .button-secondary:hover {
            background: var(--primary);
            color: white;
        }

        /* Checkbox Lists */
        .checklist {
            margin: 1rem 0;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            margin: 0.5rem 0;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .checklist-item.completed {
            background: rgba(76, 175, 80, 0.05);
            border-color: var(--success);
        }

        .checklist-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .checklist-label {
            flex: 1;
            cursor: pointer;
        }

        .checklist-item.completed .checklist-label {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        /* Technique Counter */
        .technique-counter {
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span>üß†</span>
                <span>NeuroThrive Daily</span>
            </div>
            <button class="install-button" id="installButton">
                Install App
            </button>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="nav-tabs">
        <div class="nav-tabs-inner">
            <button class="nav-tab active" data-tab="dashboard">Dashboard</button>
            <button class="nav-tab" data-tab="journal">Journal</button>
            <button class="nav-tab" data-tab="routine">Routine</button>
            <button class="nav-tab" data-tab="meals">Meals</button>
            <button class="nav-tab" data-tab="therapy">Therapy</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="content">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <!-- Today's Overview -->
            <div class="card">
                <h2 class="card-title">
                    <span>üìä</span>
                    Today's Overview
                </h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="todayWins">0</div>
                        <div class="stat-label">Wins Today</div>
                    </div>
                    <div class="stat-box" style="background: linear-gradient(135deg, var(--success), var(--secondary))">
                        <div class="stat-value" id="todayMoods">0/3</div>
                        <div class="stat-label">Mood Checks</div>
                    </div>
                    <div class="stat-box" style="background: linear-gradient(135deg, var(--accent), var(--warning))">
                        <div class="stat-value" id="todayTherapy">0</div>
                        <div class="stat-label">Therapy Uses</div>
                    </div>
                    <div class="stat-box" style="background: linear-gradient(135deg, #FF6B9D, var(--accent))">
                        <div class="stat-value" id="todayMeals">0/3</div>
                        <div class="stat-label">Meals Logged</div>
                    </div>
                </div>
            </div>

            <!-- Weekly Wins Chart -->
            <div class="card">
                <h2 class="card-title">
                    <span>üèÜ</span>
                    Weekly Wins Tracker
                </h2>
                <p class="card-subtitle">Your wins over the last 7 days</p>
                <div class="chart-container">
                    <div class="bar-chart" id="winsChart"></div>
                </div>
            </div>

            <!-- Weekly Mood Trends -->
            <div class="card">
                <h2 class="card-title">
                    <span>üòä</span>
                    Weekly Mood Trends
                </h2>
                <p class="card-subtitle">Average mood over the last 7 days</p>
                <div class="chart-container">
                    <div class="bar-chart" id="moodChart"></div>
                </div>
            </div>

            <!-- Today's Energy -->
            <div class="card">
                <h2 class="card-title">
                    <span>‚ö°</span>
                    Current Energy Level
                </h2>
                <div class="energy-meter">
                    <div class="energy-bar">
                        <div class="energy-fill" id="energyFill" style="width: 70%">
                            7/10
                        </div>
                    </div>
                </div>
                <p class="card-subtitle">Based on your latest mood check-in</p>
            </div>

            <!-- Quick Actions -->
            <div class="card">
                <h2 class="card-title">Quick Actions</h2>
                <div class="quick-actions">
                    <div class="quick-action" onclick="showMoodDialog()">
                        <div class="quick-action-icon">üòä</div>
                        <div>Mood Check</div>
                    </div>
                    <div class="quick-action" onclick="switchTab('journal')">
                        <div class="quick-action-icon">üèÜ</div>
                        <div>Log Win</div>
                    </div>
                    <div class="quick-action" onclick="switchTab('meals')">
                        <div class="quick-action-icon">üçΩÔ∏è</div>
                        <div>Log Meal</div>
                    </div>
                    <div class="quick-action" onclick="startGardenBreak()">
                        <div class="quick-action-icon">üåø</div>
                        <div>Garden Break</div>
                    </div>
                </div>
            </div>

            <!-- 5:15 PM Boundary -->
            <div class="card" id="boundaryCard" style="display: none;">
                <div class="hard-stop-banner">
                    <div class="hard-stop-icon">üõë</div>
                    <div class="hard-stop-text">
                        <div class="hard-stop-title">5:15 PM - HARD STOP!</div>
                        <div>Time to disconnect and start evening routine</div>
                    </div>
                    <button class="acknowledge-button" onclick="acknowledgeBoundary()">
                        I'm stopping now
                    </button>
                </div>
            </div>
        </div>

        <!-- Journal Tab -->
        <div id="journal" class="tab-content">
            <!-- Journal Entry with 3x Daily Mood -->
            <div class="card">
                <h2 class="card-title">
                    <span>üìù</span>
                    Daily Journal Entry
                </h2>
                <p class="card-subtitle">Log your thoughts, wins, and reflections</p>
                <textarea class="win-input" id="journalEntry" placeholder="How's your day going? What are you grateful for? Any wins to celebrate?"></textarea>

                <button class="button-primary" onclick="saveJournalEntry()" style="width: 100%; margin-top: 1rem;">
                    Save Journal Entry
                </button>

                <!-- 3x Daily Mood Tracking -->
                <h3 style="margin-top: 1.5rem; margin-bottom: 1rem; font-size: 1.1rem;">Track Mood & Energy (3x Daily)</h3>
                <div class="mood-tracker">
                    <div class="mood-time" id="morningMood" onclick="showMoodDialog('morning')">
                        <div class="mood-emoji">üåÖ</div>
                        <div class="mood-label">Morning</div>
                        <div class="mood-time-range">Before 11 AM</div>
                        <div class="mood-value">Not logged</div>
                    </div>
                    <div class="mood-time" id="middayMood" onclick="showMoodDialog('midday')">
                        <div class="mood-emoji">‚òÄÔ∏è</div>
                        <div class="mood-label">Midday</div>
                        <div class="mood-time-range">11 AM - 3 PM</div>
                        <div class="mood-value">Not logged</div>
                    </div>
                    <div class="mood-time" id="eveningMood" onclick="showMoodDialog('evening')">
                        <div class="mood-emoji">üåô</div>
                        <div class="mood-label">Evening</div>
                        <div class="mood-time-range">5 PM - 10 PM</div>
                        <div class="mood-value">Not logged</div>
                    </div>
                </div>
            </div>

            <!-- Gratitude -->
            <div class="card">
                <h2 class="card-title">
                    <span>üíõ</span>
                    Gratitude Journal
                </h2>
                <input type="text" class="imposter-input" id="gratitudeInput"
                       placeholder="What are you grateful for?"
                       onkeypress="if(event.key==='Enter') addGratitude()">
                <button class="button-primary" onclick="addGratitude()" style="width: 100%; margin-top: 0.5rem;">
                    Add Gratitude
                </button>
                <div id="gratitudeList" style="margin-top: 1rem;"></div>
            </div>

            <!-- Win Entry with Parser -->
            <div class="card">
                <h2 class="card-title">
                    <span>üèÜ</span>
                    Log Your Wins
                </h2>
                <p class="card-subtitle">Enter wins in any format - they'll be parsed automatically!</p>
                <textarea class="win-input" id="winInput" placeholder="Examples:
‚Ä¢ Completed morning routine
‚Ä¢ Applied to 3 jobs
‚Ä¢ Managed anxiety well
1. Took garden break
2. Ate healthy lunch

Or just write naturally - the parser will detect your wins!" oninput="parseWins()"></textarea>

                <div id="winPreview" style="display: none;">
                    <div class="win-preview">
                        <strong>Detected <span id="winCount">0</span> wins:</strong>
                        <div id="winList"></div>
                    </div>
                </div>

                <button class="button-primary" onclick="saveWins()" style="width: 100%; margin-top: 1rem;">
                    Save Wins
                </button>
            </div>

            <!-- Past Journal Entries -->
            <div class="card">
                <h2 class="card-title">
                    <span>üìñ</span>
                    Past Journal Entries
                </h2>
                <input type="text" class="search-bar" id="journalSearch"
                       placeholder="Search by keyword (mood, energy, health, therapy, etc.)"
                       oninput="filterJournalEntries()">

                <div id="journalEntriesList" class="journal-entries">
                    <p style="color: var(--text-secondary); text-align: center;">No entries yet. Start journaling above!</p>
                </div>
            </div>

            <!-- Weekly Review -->
            <div class="card">
                <h2 class="card-title">
                    <span>üìä</span>
                    Weekly Review
                </h2>
                <button class="button-primary" onclick="generateWeeklyReview()" style="width: 100%;">
                    Generate This Week's Summary
                </button>
                <div id="weeklyReviewContent" style="margin-top: 1rem;"></div>
            </div>
        </div>

        <!-- Routine Tab -->
        <div id="routine" class="tab-content">
            <!-- Time-based routine display -->
            <div id="routineContent"></div>
        </div>

        <!-- Meals Tab -->
        <div id="meals" class="tab-content">
            <div class="card">
                <h2 class="card-title">
                    <span>üçΩÔ∏è</span>
                    Daily Meal Planning & Tracking
                </h2>
                <p class="card-subtitle">Plan and track your meals throughout the day</p>

                <div class="meal-grid">
                    <!-- Breakfast -->
                    <div class="meal-card">
                        <div class="meal-time">
                            <span>üåÖ</span>
                            <span>Breakfast</span>
                        </div>
                        <input type="text" class="meal-input" id="breakfastInput"
                               placeholder="What did you have for breakfast?"
                               onkeypress="if(event.key==='Enter') saveMeal('breakfast')">
                        <button class="button-primary" onclick="saveMeal('breakfast')" style="width: 100%; padding: 0.5rem;">
                            Save Breakfast
                        </button>
                        <div class="meal-history" id="breakfastHistory"></div>
                    </div>

                    <!-- Lunch -->
                    <div class="meal-card">
                        <div class="meal-time">
                            <span>‚òÄÔ∏è</span>
                            <span>Lunch</span>
                        </div>
                        <input type="text" class="meal-input" id="lunchInput"
                               placeholder="What did you have for lunch?"
                               onkeypress="if(event.key==='Enter') saveMeal('lunch')">
                        <button class="button-primary" onclick="saveMeal('lunch')" style="width: 100%; padding: 0.5rem;">
                            Save Lunch
                        </button>
                        <div class="meal-history" id="lunchHistory"></div>
                    </div>

                    <!-- Dinner -->
                    <div class="meal-card">
                        <div class="meal-time">
                            <span>üåô</span>
                            <span>Dinner</span>
                        </div>
                        <input type="text" class="meal-input" id="dinnerInput"
                               placeholder="What did you have for dinner?"
                               onkeypress="if(event.key==='Enter') saveMeal('dinner')">
                        <button class="button-primary" onclick="saveMeal('dinner')" style="width: 100%; padding: 0.5rem;">
                            Save Dinner
                        </button>
                        <div class="meal-history" id="dinnerHistory"></div>
                    </div>
                </div>
            </div>

            <!-- Weekly Meal Summary -->
            <div class="card">
                <h2 class="card-title">
                    <span>üìä</span>
                    Weekly Meal Summary
                </h2>
                <button class="button-primary" onclick="generateMealSummary()" style="width: 100%;">
                    View This Week's Meals
                </button>
                <div id="mealSummaryContent" style="margin-top: 1rem;"></div>
            </div>
        </div>

        <!-- Therapy Tab -->
        <div id="therapy" class="tab-content">
            <!-- Imposter Syndrome Counter -->
            <div class="card">
                <h2 class="card-title">
                    <span>üé≠</span>
                    Imposter Syndrome Counter - Find Your Facts (FYF)
                </h2>
                <p class="card-subtitle">Type negative thoughts and I'll help counter them with evidence-based facts</p>

                <input type="text" class="imposter-input" id="imposterInput"
                       placeholder="What's the negative thought? (e.g., 'I'm not good enough', 'I don't deserve this')"
                       oninput="detectNegativeThought()">

                <div id="negativeDetected" style="display: none; margin: 1rem 0;">
                    <div style="background: rgba(255,193,7,0.1); padding: 0.5rem; border-radius: 8px; color: #F57C00;">
                        ‚ö†Ô∏è Negative thought pattern detected
                    </div>
                </div>

                <div id="believabilityBefore" style="display: none;">
                    <p style="margin: 1rem 0;"><strong>Step 1:</strong> How believable is this thought right now? (1-10)</p>
                    <div class="believability-scale" id="scaleBeforeButtons">
                        <button class="scale-button" onclick="setBelievability('before', 1)">1</button>
                        <button class="scale-button" onclick="setBelievability('before', 2)">2</button>
                        <button class="scale-button" onclick="setBelievability('before', 3)">3</button>
                        <button class="scale-button" onclick="setBelievability('before', 4)">4</button>
                        <button class="scale-button" onclick="setBelievability('before', 5)">5</button>
                        <button class="scale-button" onclick="setBelievability('before', 6)">6</button>
                        <button class="scale-button" onclick="setBelievability('before', 7)">7</button>
                        <button class="scale-button" onclick="setBelievability('before', 8)">8</button>
                        <button class="scale-button" onclick="setBelievability('before', 9)">9</button>
                        <button class="scale-button" onclick="setBelievability('before', 10)">10</button>
                    </div>
                </div>

                <div id="counterFacts" style="display: none;">
                    <div class="counter-facts">
                        <h3><strong>Step 2:</strong> Evidence Against This Thought:</h3>
                        <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">
                            Based on CBT (Cognitive Behavioral Therapy) principles: Challenge negative thoughts with concrete evidence.
                        </p>
                        <div id="factsList"></div>
                    </div>

                    <div id="believabilityAfter">
                        <p style="margin: 1rem 0;"><strong>Step 3:</strong> After reviewing these facts, how believable is the thought now? (1-10)</p>
                        <div class="believability-scale" id="scaleAfterButtons">
                            <button class="scale-button" onclick="setBelievability('after', 1)">1</button>
                            <button class="scale-button" onclick="setBelievability('after', 2)">2</button>
                            <button class="scale-button" onclick="setBelievability('after', 3)">3</button>
                            <button class="scale-button" onclick="setBelievability('after', 4)">4</button>
                            <button class="scale-button" onclick="setBelievability('after', 5)">5</button>
                            <button class="scale-button" onclick="setBelievability('after', 6)">6</button>
                            <button class="scale-button" onclick="setBelievability('after', 7)">7</button>
                            <button class="scale-button" onclick="setBelievability('after', 8)">8</button>
                            <button class="scale-button" onclick="setBelievability('after', 9)">9</button>
                            <button class="scale-button" onclick="setBelievability('after', 10)">10</button>
                        </div>
                    </div>

                    <button class="button-primary" onclick="saveImposterSession()" style="width: 100%; margin-top: 1rem;">
                        <strong>Step 4:</strong> Save Session
                    </button>
                </div>
            </div>

            <!-- Box Breathing with 4-Step Counter -->
            <div class="card">
                <h2 class="card-title">
                    <span>ü´Å</span>
                    Box Breathing Exercise (4-4-4-4)
                </h2>
                <p class="card-subtitle">Track each step of your breathing cycle</p>

                <div class="breathing-cycle">
                    <div class="breathing-step" id="breathe-in">
                        <div class="breathing-step-name">
                            <span>1Ô∏è‚É£</span>
                            <span>Breathe In</span>
                        </div>
                        <div class="breathing-countdown" id="countdown-breathe-in"></div>
                        <div class="breathing-counter" id="counter-breathe-in">0</div>
                    </div>

                    <div class="breathing-step" id="hold-in">
                        <div class="breathing-step-name">
                            <span>2Ô∏è‚É£</span>
                            <span>Hold</span>
                        </div>
                        <div class="breathing-countdown" id="countdown-hold-in"></div>
                        <div class="breathing-counter" id="counter-hold-in">0</div>
                    </div>

                    <div class="breathing-step" id="breathe-out">
                        <div class="breathing-step-name">
                            <span>3Ô∏è‚É£</span>
                            <span>Breathe Out</span>
                        </div>
                        <div class="breathing-countdown" id="countdown-breathe-out"></div>
                        <div class="breathing-counter" id="counter-breathe-out">0</div>
                    </div>

                    <div class="breathing-step" id="hold-out">
                        <div class="breathing-step-name">
                            <span>4Ô∏è‚É£</span>
                            <span>Hold</span>
                        </div>
                        <div class="breathing-countdown" id="countdown-hold-out"></div>
                        <div class="breathing-counter" id="counter-hold-out">0</div>
                    </div>
                </div>

                <div class="breathing-controls">
                    <button class="button-primary" onclick="startBreathingCycle()" id="breathingStartBtn">
                        Start Breathing Exercise
                    </button>
                    <button class="button-secondary" onclick="resetBreathingCycle()" style="display: none;" id="breathingResetBtn">
                        Reset
                    </button>
                </div>

                <div style="text-align: center; margin-top: 1rem; color: var(--text-secondary);">
                    <strong>Total Cycles Completed:</strong> <span id="totalBreathingCycles">0</span>
                </div>
            </div>

            <!-- Therapy Techniques with Counters -->
            <div class="card">
                <h2 class="card-title">
                    <span>üßò</span>
                    Therapy Techniques - Track Your Practice
                </h2>
                <p class="card-subtitle">Click when you use a technique to track your progress</p>
                <div class="checklist">
                    <div class="checklist-item" onclick="toggleTherapyTechnique(this, 'grounding')">
                        <input type="checkbox" class="checklist-checkbox">
                        <label class="checklist-label">
                            5-4-3-2-1 Grounding
                            <span class="technique-counter" id="counter-grounding">0</span>
                        </label>
                    </div>
                    <div class="checklist-item" onclick="toggleTherapyTechnique(this, 'thought')">
                        <input type="checkbox" class="checklist-checkbox">
                        <label class="checklist-label">
                            Thought Record
                            <span class="technique-counter" id="counter-thought">0</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="bottom-nav-item active" onclick="switchTab('dashboard')">
            <span class="bottom-nav-icon">üìä</span>
            <span class="bottom-nav-label">Dashboard</span>
        </button>
        <button class="bottom-nav-item" onclick="switchTab('journal')">
            <span class="bottom-nav-icon">üìù</span>
            <span class="bottom-nav-label">Journal</span>
        </button>
        <button class="bottom-nav-item" onclick="switchTab('routine')">
            <span class="bottom-nav-icon">‚úÖ</span>
            <span class="bottom-nav-label">Routine</span>
        </button>
        <button class="bottom-nav-item" onclick="switchTab('meals')">
            <span class="bottom-nav-icon">üçΩÔ∏è</span>
            <span class="bottom-nav-label">Meals</span>
        </button>
        <button class="bottom-nav-item" onclick="switchTab('therapy')">
            <span class="bottom-nav-icon">üßò</span>
            <span class="bottom-nav-label">Therapy</span>
        </button>
    </nav>

    <!-- Install Prompt -->
    <div class="install-prompt" id="installPrompt">
        <div class="install-prompt-content">
            <div class="install-prompt-icon">üì±</div>
            <div class="install-prompt-text">
                <div class="install-prompt-title">Install NeuroThrive Daily</div>
                <div>Add to your home screen for easy access</div>
            </div>
        </div>
        <div class="install-prompt-buttons">
            <button class="install-accept" onclick="installApp()">Install</button>
            <button class="install-decline" onclick="dismissInstall()">Not Now</button>
        </div>
    </div>

    <script>
        // PWA Installation
        let deferredPrompt;
        const installButton = document.getElementById('installButton');
        const installPrompt = document.getElementById('installPrompt');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'block';

            setTimeout(() => {
                if (deferredPrompt) {
                    installPrompt.style.display = 'block';
                }
            }, 30000);
        });

        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response: ${outcome}`);
                deferredPrompt = null;
                installButton.style.display = 'none';
            }
        });

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted installation');
                    }
                    deferredPrompt = null;
                    installPrompt.style.display = 'none';
                });
            }
        }

        function dismissInstall() {
            installPrompt.style.display = 'none';
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => console.log('SW registered:', registration))
                    .catch(err => console.log('SW registration failed:', err));
            });
        }

        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                }
            });

            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');

            document.querySelectorAll('.bottom-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');

            if (tabName === 'routine') {
                loadRoutineForTime();
            }

            if (tabName === 'journal') {
                loadJournalEntries();
            }

            if (tabName === 'dashboard') {
                updateDashboard();
            }

            if (tabName === 'meals') {
                loadMealHistory();
            }
        }

        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                switchTab(tab.dataset.tab);
            });
        });

        // Dashboard Functions
        function updateDashboard() {
            updateDashboardStats();
            renderWinsChart();
            renderMoodChart();
        }

        function updateDashboardStats() {
            const today = new Date().toISOString().split('T')[0];

            // Today's wins
            const wins = JSON.parse(localStorage.getItem('wins') || '{}');
            const todayWins = (wins[today] || []).length;
            document.getElementById('todayWins').textContent = todayWins;

            // Today's moods
            const moods = JSON.parse(localStorage.getItem('moods') || '{}');
            const todayMoods = moods[today] || {};
            const moodCount = Object.keys(todayMoods).length;
            document.getElementById('todayMoods').textContent = `${moodCount}/3`;

            // Today's therapy
            const techniques = JSON.parse(localStorage.getItem('therapyTechniques') || '{}');
            const todayTherapy = Object.values(techniques).reduce((a, b) => a + b, 0);
            document.getElementById('todayTherapy').textContent = todayTherapy;

            // Today's meals
            const meals = JSON.parse(localStorage.getItem('meals') || '{}');
            const todayMeals = meals[today] || {};
            const mealCount = Object.keys(todayMeals).length;
            document.getElementById('todayMeals').textContent = `${mealCount}/3`;

            // Update energy based on latest mood
            if (moodCount > 0) {
                const latestMood = Object.values(todayMoods).pop();
                if (latestMood) {
                    const energyPercent = (latestMood.energy / 10) * 100;
                    document.getElementById('energyFill').style.width = energyPercent + '%';
                    document.getElementById('energyFill').textContent = `${latestMood.energy}/10`;
                }
            }
        }

        function renderWinsChart() {
            const wins = JSON.parse(localStorage.getItem('wins') || '{}');
            const chart = document.getElementById('winsChart');
            const days = [];

            // Get last 7 days
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                days.push(date.toISOString().split('T')[0]);
            }

            // Build chart
            const maxWins = Math.max(...days.map(d => (wins[d] || []).length), 1);

            chart.innerHTML = days.map(date => {
                const count = (wins[date] || []).length;
                const height = (count / maxWins) * 100;
                const dayName = new Date(date).toLocaleDateString('en-US', { weekday: 'short' });

                return `
                    <div class="bar" style="height: ${height}%">
                        <div class="bar-value">${count}</div>
                        <div class="bar-label">${dayName}</div>
                    </div>
                `;
            }).join('');
        }

        function renderMoodChart() {
            const moods = JSON.parse(localStorage.getItem('moods') || '{}');
            const chart = document.getElementById('moodChart');
            const days = [];

            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                days.push(date.toISOString().split('T')[0]);
            }

            chart.innerHTML = days.map(date => {
                const dayMoods = moods[date] || {};
                const moodValues = Object.values(dayMoods).map(m => m.mood);
                const avgMood = moodValues.length > 0
                    ? moodValues.reduce((a, b) => a + b, 0) / moodValues.length
                    : 0;
                const height = (avgMood / 10) * 100;
                const dayName = new Date(date).toLocaleDateString('en-US', { weekday: 'short' });

                return `
                    <div class="bar" style="height: ${height}%">
                        <div class="bar-value">${avgMood.toFixed(1)}</div>
                        <div class="bar-label">${dayName}</div>
                    </div>
                `;
            }).join('');
        }

        // Win Parser
        function parseWins() {
            const input = document.getElementById('winInput').value;
            if (!input.trim()) {
                document.getElementById('winPreview').style.display = 'none';
                return;
            }

            const lines = input.split('\n');
            const wins = [];

            lines.forEach(line => {
                const trimmed = line.trim();
                if (!trimmed) return;

                const bulletMatch = trimmed.match(/^[‚Ä¢\-\*]\s+(.+)$/);
                if (bulletMatch) {
                    wins.push(bulletMatch[1]);
                    return;
                }

                const numberMatch = trimmed.match(/^\d+[.)]\s+(.+)$/);
                if (numberMatch) {
                    wins.push(numberMatch[1]);
                    return;
                }

                if (trimmed.length > 5) {
                    wins.push(trimmed);
                }
            });

            if (wins.length > 0) {
                document.getElementById('winPreview').style.display = 'block';
                document.getElementById('winCount').textContent = wins.length;

                const winList = document.getElementById('winList');
                winList.innerHTML = wins.map(win => {
                    const category = categorizeWin(win);
                    return `
                        <div class="win-item">
                            <span class="win-bullet">‚úì</span>
                            <span>${win}</span>
                            <span class="win-category">${category}</span>
                        </div>
                    `;
                }).join('');
            } else {
                document.getElementById('winPreview').style.display = 'none';
            }
        }

        function categorizeWin(text) {
            const lower = text.toLowerCase();
            if (lower.includes('routine') || lower.includes('morning') || lower.includes('evening')) {
                return 'Routine';
            }
            if (lower.includes('health') || lower.includes('medication') || lower.includes('exercise')) {
                return 'Health';
            }
            if (lower.includes('mood') || lower.includes('energy') || lower.includes('mental')) {
                return 'Mental Health';
            }
            if (lower.includes('therapy') || lower.includes('grounding') || lower.includes('breathing')) {
                return 'Therapy';
            }
            return 'Personal';
        }

        function extractKeywords(text) {
            const keywordPatterns = [
                'interview', 'resume',
                'mood', 'energy', 'anxiety', 'depression', 'stress',
                'health', 'medication', 'exercise', 'sleep',
                'routine', 'morning', 'evening', 'midday',
                'therapy', 'grounding', 'breathing',
                'win', 'success', 'achievement', 'progress',
                'meal', 'breakfast', 'lunch', 'dinner'
            ];

            const lower = text.toLowerCase();
            return keywordPatterns.filter(keyword => lower.includes(keyword));
        }

        function saveJournalEntry() {
            const entryText = document.getElementById('journalEntry').value.trim();

            if (!entryText) {
                alert('Please write something in your journal first!');
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const timestamp = new Date().toISOString();

            const moods = JSON.parse(localStorage.getItem('moods') || '{}');
            const todayMoods = moods[today] || {};

            const keywords = extractKeywords(entryText);

            const entry = {
                date: today,
                timestamp: timestamp,
                content: entryText,
                moods: todayMoods,
                keywords: keywords
            };

            const journalEntries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
            journalEntries.push(entry);
            localStorage.setItem('journalEntries', JSON.stringify(journalEntries));

            document.getElementById('journalEntry').value = '';

            showSuccessMessage('Journal entry saved! üìù');

            loadJournalEntries();
        }

        function loadJournalEntries() {
            const journalEntries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
            const container = document.getElementById('journalEntriesList');

            if (journalEntries.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No entries yet. Start journaling above!</p>';
                return;
            }

            journalEntries.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            container.innerHTML = journalEntries.map(entry => {
                const date = new Date(entry.timestamp);
                const dateStr = date.toLocaleDateString('en-US', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                const timeStr = date.toLocaleTimeString('en-US', {
                    hour: 'numeric',
                    minute: '2-digit'
                });

                let moodSummary = '';
                if (entry.moods && Object.keys(entry.moods).length > 0) {
                    const moodParts = [];
                    if (entry.moods.morning) moodParts.push(`Morning: ${entry.moods.morning.mood}/10 energy`);
                    if (entry.moods.midday) moodParts.push(`Midday: ${entry.moods.midday.mood}/10 energy`);
                    if (entry.moods.evening) moodParts.push(`Evening: ${entry.moods.evening.mood}/10 energy`);
                    if (moodParts.length > 0) {
                        moodSummary = `<p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem;">${moodParts.join(' ‚Ä¢ ')}</p>`;
                    }
                }

                return `
                    <div class="journal-entry">
                        <div class="journal-entry-date">${dateStr} at ${timeStr}</div>
                        <div class="journal-entry-content">${entry.content}</div>
                        ${moodSummary}
                        ${entry.keywords && entry.keywords.length > 0 ? `
                            <div class="journal-entry-keywords">
                                ${entry.keywords.map(kw => `<span class="keyword-tag">${kw}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function filterJournalEntries() {
            const searchTerm = document.getElementById('journalSearch').value.toLowerCase().trim();
            const journalEntries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
            const container = document.getElementById('journalEntriesList');

            if (journalEntries.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No entries yet. Start journaling above!</p>';
                return;
            }

            let filteredEntries = journalEntries;
            if (searchTerm) {
                filteredEntries = journalEntries.filter(entry =>
                    entry.content.toLowerCase().includes(searchTerm) ||
                    (entry.keywords && entry.keywords.some(kw => kw.includes(searchTerm)))
                );
            }

            if (filteredEntries.length === 0) {
                container.innerHTML = `<p style="color: var(--text-secondary); text-align: center;">No entries found matching "${searchTerm}"</p>`;
                return;
            }

            filteredEntries.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            container.innerHTML = filteredEntries.map(entry => {
                const date = new Date(entry.timestamp);
                const dateStr = date.toLocaleDateString('en-US', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                const timeStr = date.toLocaleTimeString('en-US', {
                    hour: 'numeric',
                    minute: '2-digit'
                });

                let moodSummary = '';
                if (entry.moods && Object.keys(entry.moods).length > 0) {
                    const moodParts = [];
                    if (entry.moods.morning) moodParts.push(`Morning: ${entry.moods.morning.mood}/10 energy`);
                    if (entry.moods.midday) moodParts.push(`Midday: ${entry.moods.midday.mood}/10 energy`);
                    if (entry.moods.evening) moodParts.push(`Evening: ${entry.moods.evening.mood}/10 energy`);
                    if (moodParts.length > 0) {
                        moodSummary = `<p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem;">${moodParts.join(' ‚Ä¢ ')}</p>`;
                    }
                }

                return `
                    <div class="journal-entry">
                        <div class="journal-entry-date">${dateStr} at ${timeStr}</div>
                        <div class="journal-entry-content">${entry.content}</div>
                        ${moodSummary}
                        ${entry.keywords && entry.keywords.length > 0 ? `
                            <div class="journal-entry-keywords">
                                ${entry.keywords.map(kw => `<span class="keyword-tag">${kw}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function generateWeeklyReview() {
            const journalEntries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
            const wins = JSON.parse(localStorage.getItem('wins') || '{}');
            const imposterSessions = JSON.parse(localStorage.getItem('imposterSessions') || '[]');
            const container = document.getElementById('weeklyReviewContent');

            const today = new Date();
            const weekAgo = new Date(today);
            weekAgo.setDate(weekAgo.getDate() - 7);

            const weekEntries = journalEntries.filter(entry =>
                new Date(entry.timestamp) >= weekAgo
            );

            const weekSessions = imposterSessions.filter(session =>
                new Date(session.date) >= weekAgo
            );

            const totalEntries = weekEntries.length;
            const totalWins = Object.entries(wins)
                .filter(([date]) => new Date(date) >= weekAgo)
                .reduce((sum, [, winsArray]) => sum + winsArray.length, 0);

            const avgMoodChange = weekSessions.length > 0
                ? weekSessions.reduce((sum, s) => sum + s.reduction, 0) / weekSessions.length
                : 0;

            const allKeywords = weekEntries.flatMap(e => e.keywords || []);
            const keywordCounts = {};
            allKeywords.forEach(kw => {
                keywordCounts[kw] = (keywordCounts[kw] || 0) + 1;
            });
            const topKeywords = Object.entries(keywordCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([kw]) => kw);

            container.innerHTML = `
                <div style="background: rgba(107, 70, 193, 0.05); border: 2px solid var(--primary); border-radius: 8px; padding: 1rem;">
                    <h3 style="color: var(--primary); margin-bottom: 1rem;">Week of ${weekAgo.toLocaleDateString()} - ${today.toLocaleDateString()}</h3>

                    <p><strong>üìù Journal Entries:</strong> ${totalEntries}</p>
                    <p><strong>üèÜ Wins Logged:</strong> ${totalWins}</p>
                    <p><strong>üé≠ Therapy Sessions:</strong> ${weekSessions.length}</p>
                    ${avgMoodChange > 0 ? `<p><strong>üìä Avg Thought Reduction:</strong> ${avgMoodChange.toFixed(1)} points</p>` : ''}

                    ${topKeywords.length > 0 ? `
                        <p style="margin-top: 1rem;"><strong>Top Themes:</strong></p>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;">
                            ${topKeywords.map(kw => `<span class="keyword-tag">${kw}</span>`).join('')}
                        </div>
                    ` : ''}

                    <p style="margin-top: 1rem; color: var(--text-secondary); font-style: italic;">
                        Keep up the great work! You're building healthy habits. üí™
                    </p>
                </div>
            `;
        }

        function saveWins() {
            const wins = [];
            document.querySelectorAll('#winList .win-item').forEach(item => {
                const text = item.querySelector('span:nth-child(2)').textContent;
                wins.push(text);
            });

            if (wins.length > 0) {
                const today = new Date().toISOString().split('T')[0];
                const savedWins = JSON.parse(localStorage.getItem('wins') || '{}');
                savedWins[today] = (savedWins[today] || []).concat(wins);
                localStorage.setItem('wins', JSON.stringify(savedWins));

                document.getElementById('winInput').value = '';
                document.getElementById('winPreview').style.display = 'none';

                showSuccessMessage(`${wins.length} wins saved! üéâ`);
                updateDashboard();
            }
        }

        // Mood Tracking
        function showMoodDialog(timeOfDay) {
            const now = new Date();
            const hour = now.getHours();

            if (timeOfDay === 'morning' && hour >= 11) {
                alert('Morning mood tracking is for before 11 AM. You can track midday or evening mood now.');
                return;
            }
            if (timeOfDay === 'midday' && (hour < 11 || hour >= 15)) {
                if (hour < 11) {
                    alert('Midday mood tracking is for 11 AM - 3 PM. Please track morning mood now.');
                } else {
                    alert('Midday mood tracking is for 11 AM - 3 PM. You can track evening mood now.');
                }
                return;
            }
            if (timeOfDay === 'evening' && hour < 17) {
                if (hour < 11) {
                    alert('Evening mood tracking is for 5 PM - 10 PM. Please track morning mood now.');
                } else {
                    alert('Evening mood tracking is for 5 PM - 10 PM. Please track midday mood now.');
                }
                return;
            }

            const mood = prompt(`Rate your mood (1-10):`);
            const energy = prompt(`Rate your energy (1-10):`);

            if (mood && energy) {
                const moodElement = document.getElementById(`${timeOfDay}Mood`);
                moodElement.classList.add('completed');
                moodElement.querySelector('.mood-value').textContent = `Mood: ${mood}, Energy: ${energy}`;

                const today = new Date().toISOString().split('T')[0];
                const moods = JSON.parse(localStorage.getItem('moods') || '{}');
                moods[today] = moods[today] || {};
                moods[today][timeOfDay] = { mood: parseInt(mood), energy: parseInt(energy), time: now.toISOString() };
                localStorage.setItem('moods', JSON.stringify(moods));

                showSuccessMessage(`${timeOfDay.charAt(0).toUpperCase() + timeOfDay.slice(1)} mood logged!`);
                updateDashboard();
            }
        }

        // Gratitude
        function addGratitude() {
            const input = document.getElementById('gratitudeInput');
            const text = input.value.trim();

            if (text) {
                const now = new Date();
                const time = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

                const gratitudeList = document.getElementById('gratitudeList');
                const entry = document.createElement('div');
                entry.className = 'gratitude-entry';
                entry.innerHTML = `
                    <div class="gratitude-text">${text}</div>
                    <div class="gratitude-time">${time}</div>
                `;
                gratitudeList.insertBefore(entry, gratitudeList.firstChild);

                const today = new Date().toISOString().split('T')[0];
                const gratitudes = JSON.parse(localStorage.getItem('gratitudes') || '{}');
                gratitudes[today] = (gratitudes[today] || []).concat({ text, time });
                localStorage.setItem('gratitudes', JSON.stringify(gratitudes));

                input.value = '';
            }
        }

        // Meal Planning & Tracking
        function saveMeal(mealType) {
            const input = document.getElementById(`${mealType}Input`);
            const mealText = input.value.trim();

            if (!mealText) {
                alert(`Please enter what you had for ${mealType}!`);
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const meals = JSON.parse(localStorage.getItem('meals') || '{}');

            if (!meals[today]) meals[today] = {};
            if (!meals[today][mealType]) meals[today][mealType] = [];

            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

            meals[today][mealType].push({
                food: mealText,
                time: time
            });

            localStorage.setItem('meals', JSON.stringify(meals));

            input.value = '';
            showSuccessMessage(`${mealType.charAt(0).toUpperCase() + mealType.slice(1)} logged! üçΩÔ∏è`);

            loadMealHistory();
            updateDashboard();
        }

        function loadMealHistory() {
            const today = new Date().toISOString().split('T')[0];
            const meals = JSON.parse(localStorage.getItem('meals') || '{}');
            const todayMeals = meals[today] || {};

            ['breakfast', 'lunch', 'dinner'].forEach(mealType => {
                const history = document.getElementById(`${mealType}History`);
                const mealList = todayMeals[mealType] || [];

                if (mealList.length > 0) {
                    history.innerHTML = `
                        <strong>Today:</strong>
                        ${mealList.map(meal => `
                            <div class="meal-history-item">‚Ä¢ ${meal.food} (${meal.time})</div>
                        `).join('')}
                    `;
                } else {
                    history.innerHTML = '<div class="meal-history-item">No meals logged today</div>';
                }
            });
        }

        function generateMealSummary() {
            const meals = JSON.parse(localStorage.getItem('meals') || '{}');
            const container = document.getElementById('mealSummaryContent');

            const today = new Date();
            const weekAgo = new Date(today);
            weekAgo.setDate(weekAgo.getDate() - 7);

            const weekDates = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                weekDates.push(date.toISOString().split('T')[0]);
            }

            let totalBreakfast = 0;
            let totalLunch = 0;
            let totalDinner = 0;

            weekDates.forEach(date => {
                if (meals[date]) {
                    if (meals[date].breakfast) totalBreakfast += meals[date].breakfast.length;
                    if (meals[date].lunch) totalLunch += meals[date].lunch.length;
                    if (meals[date].dinner) totalDinner += meals[date].dinner.length;
                }
            });

            container.innerHTML = `
                <div style="background: rgba(255, 179, 0, 0.05); border: 2px solid var(--accent); border-radius: 8px; padding: 1rem;">
                    <h3 style="color: var(--accent); margin-bottom: 1rem;">This Week's Meal Tracking</h3>

                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem;">
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--primary);">${totalBreakfast}/7</div>
                            <div style="color: var(--text-secondary);">Breakfasts</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--primary);">${totalLunch}/7</div>
                            <div style="color: var(--text-secondary);">Lunches</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--primary);">${totalDinner}/7</div>
                            <div style="color: var(--text-secondary);">Dinners</div>
                        </div>
                    </div>

                    <p style="color: var(--text-secondary); font-style: italic; text-align: center;">
                        ${(totalBreakfast + totalLunch + totalDinner) >= 18
                            ? 'Excellent meal tracking this week! üéâ'
                            : 'Keep logging your meals for better insights! üí™'}
                    </p>
                </div>
            `;
        }

        // Routine Management
        function loadRoutineForTime() {
            const now = new Date();
            const hour = now.getHours();
            const content = document.getElementById('routineContent');

            if (hour < 11) {
                content.innerHTML = `
                    <div class="card">
                        <h2 class="card-title">üåÖ Morning Routine</h2>
                        <p class="card-subtitle">Start your day right</p>
                        <div class="checklist">
                            <div class="checklist-item" onclick="toggleRoutineItem(this)">
                                <input type="checkbox" class="checklist-checkbox">
                                <label class="checklist-label">Wake up naturally</label>
                            </div>
                            <div class="checklist-item" onclick="toggleRoutineItem(this)">
                                <input type="checkbox" class="checklist-checkbox">
                                <label class="checklist-label">Take medications</label>
                            </div>
                            <div class="checklist-item" onclick="toggleRoutineItem(this)">
                                <input type="checkbox" class="checklist-checkbox">
                                <label class="checklist-label">Light breakfast</label>
                            </div>
                            <div class="checklist-item" onclick="toggleRoutineItem(this)">
                                <input type="checkbox" class="checklist-checkbox">
                                <label class="checklist-label">Morning skincare routine</label>
                            </div>
                            <div class="checklist-item" onclick="toggleRoutineItem(this)">
                                <input type="checkbox" class="checklist-checkbox">
                                <label class="checklist-label">Review daily affirmation</label>
                            </div>
                            <div class="checklist-item" onclick="toggleRoutineItem(this)">
                                <input type="checkbox" class="checklist-checkbox">
                                <label class="checklist-label">Set top 3 priorities</label>
                            </div>
                        </div>
                    </div>
                `;
            } else if (hour >= 11 && hour < 15) {
                content.innerHTML = `
                    <div class="card">
                        <h2 class="card-title">‚òÄÔ∏è Midday Routine</h2>
                        <p class="card-subtitle">11:00 AM - 3:00 PM window</p>

                        <div class="timer-card">
                            <div class="timer-info">
                                <div class="timer-name">Garden Break üåø</div>
                                <div class="timer-duration">15 minutes</div>
                            </div>
                            <div class="timer-controls">
                                <div class="timer-display" id="timer1">15:00</div>
                                <button class="timer-button" onclick="toggleTimer(1, 15)">‚ñ∂</button>
                            </div>
                        </div>

                        <div class="timer-card">
                            <div class="timer-info">
                                <div class="timer-name">Late Lunch ü•ó</div>
                                <div class="timer-duration">30 minutes</div>
                            </div>
                            <div class="timer-controls">
                                <div class="timer-display" id="timer2">30:00</div>
                                <button class="timer-button" onclick="toggleTimer(2, 30)">‚ñ∂</button>
                            </div>
                        </div>

                        <div class="timer-card">
                            <div class="timer-info">
                                <div class="timer-name">Light Stretching ü§∏</div>
                                <div class="timer-duration">10 minutes</div>
                            </div>
                            <div class="timer-controls">
                                <div class="timer-display" id="timer3">10:00</div>
                                <button class="timer-button" onclick="toggleTimer(3, 10)">‚ñ∂</button>
                            </div>
                        </div>
                    </div>
                `;
            } else if (hour >= 17) {
                const is515 = hour === 17 && now.getMinutes() >= 15;

                content.innerHTML = `
                    ${is515 ? `
                        <div class="hard-stop-banner">
                            <div class="hard-stop-icon">üõë</div>
                            <div class="hard-stop-text">
                                <div class="hard-stop-title">5:15 PM - HARD STOP!</div>
                                <div>Time to disconnect and start evening routine</div>
                            </div>
                            <button class="acknowledge-button" onclick="this.parentElement.style.display='none'">
                                I'm stopping now
                            </button>
                        </div>
                    ` : ''}

                    <div class="card">
                        <h2 class="card-title">üåô Evening Routine</h2>
                        <p class="card-subtitle">5:15 PM - 10:00 PM window</p>
                        <div class="checklist">
                            <div class="checklist-item" onclick="toggleRoutineItem(this)">
                                <input type="checkbox" class="checklist-checkbox">
                                <label class="checklist-label">Stop work at 5:15 PM</label>
                            </div>
                            <div class="checklist-item" onclick="toggleRoutineItem(this)">
                                <input type="checkbox" class="checklist-checkbox">
                                <label class="checklist-label">Log daily wins</label>
                            </div>
                            <div class="checklist-item" onclick="toggleRoutineItem(this)">
                                <input type="checkbox" class="checklist-checkbox">
                                <label class="checklist-label">Evening mood check-in</label>
                            </div>
                            <div class="checklist-item" onclick="toggleRoutineItem(this)">
                                <input type="checkbox" class="checklist-checkbox">
                                <label class="checklist-label">Take evening medications</label>
                            </div>
                            <div class="checklist-item" onclick="toggleRoutineItem(this)">
                                <input type="checkbox" class="checklist-checkbox">
                                <label class="checklist-label">Evening skincare routine</label>
                            </div>
                            <div class="checklist-item" onclick="toggleRoutineItem(this)">
                                <input type="checkbox" class="checklist-checkbox">
                                <label class="checklist-label">Gratitude reflection</label>
                            </div>
                            <div class="checklist-item" onclick="toggleRoutineItem(this)">
                                <input type="checkbox" class="checklist-checkbox">
                                <label class="checklist-label">Bedtime routine</label>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div class="card">
                        <h2 class="card-title">üïê Outside Routine Hours</h2>
                        <p class="card-subtitle">Routine reminders will appear at the right times</p>
                        <ul style="margin-top: 1rem; line-height: 2;">
                            <li>Morning Routine: Before 11:00 AM</li>
                            <li>Midday Routine: 11:00 AM - 3:00 PM</li>
                            <li>Evening Routine: 5:15 PM - 10:00 PM</li>
                        </ul>
                    </div>
                `;
            }
        }

        function toggleRoutineItem(item) {
            const checkbox = item.querySelector('.checklist-checkbox');
            checkbox.checked = !checkbox.checked;

            if (checkbox.checked) {
                item.classList.add('completed');
            } else {
                item.classList.remove('completed');
            }

            const allItems = item.parentElement.querySelectorAll('.checklist-item');
            const completedItems = item.parentElement.querySelectorAll('.checklist-item.completed');

            if (allItems.length === completedItems.length && allItems.length > 0) {
                showSuccessMessage('Routine complete! Great job! üéâ');
            }
        }

        // Timer functionality
        let timers = {};

        function toggleTimer(id, minutes) {
            const button = event.target;
            const display = document.getElementById(`timer${id}`);

            if (timers[id]) {
                clearInterval(timers[id].interval);
                delete timers[id];
                button.textContent = '‚ñ∂';
                button.classList.remove('active');
            } else {
                let seconds = minutes * 60;
                timers[id] = {
                    seconds: seconds,
                    interval: setInterval(() => {
                        seconds--;
                        const mins = Math.floor(seconds / 60);
                        const secs = seconds % 60;
                        display.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;

                        if (seconds <= 0) {
                            clearInterval(timers[id].interval);
                            delete timers[id];
                            button.textContent = '‚ñ∂';
                            button.classList.remove('active');
                            alert(`Timer complete! üéâ`);
                            display.textContent = `${minutes}:00`;
                        }
                    }, 1000)
                };
                button.textContent = '‚è∏';
                button.classList.add('active');
            }
        }

        // Box Breathing with 4-Step Counter and Countdown
        let breathingInterval = null;
        let breathingCountdownInterval = null;
        let currentBreathStep = 0;
        const breathSteps = ['breathe-in', 'hold-in', 'breathe-out', 'hold-out'];

        function startBreathingCycle() {
            if (breathingInterval) return;

            document.getElementById('breathingStartBtn').style.display = 'none';
            document.getElementById('breathingResetBtn').style.display = 'inline-block';

            currentBreathStep = 0;

            function runCycle() {
                // Clear any existing countdown interval
                if (breathingCountdownInterval) {
                    clearInterval(breathingCountdownInterval);
                }

                // Remove active class from all steps
                breathSteps.forEach((step) => {
                    document.getElementById(step).classList.remove('active');
                    document.getElementById(`countdown-${step}`).textContent = '';
                });

                // Activate current step
                const currentStep = breathSteps[currentBreathStep];
                document.getElementById(currentStep).classList.add('active');

                // Increment step counter
                const counter = document.getElementById(`counter-${currentStep}`);
                counter.textContent = parseInt(counter.textContent) + 1;

                // Start countdown for this step (4 seconds)
                let countdown = 4;
                const countdownDisplay = document.getElementById(`countdown-${currentStep}`);
                countdownDisplay.textContent = countdown;

                breathingCountdownInterval = setInterval(() => {
                    countdown--;
                    if (countdown >= 0) {
                        countdownDisplay.textContent = countdown;
                    }
                }, 1000);

                // Move to next step
                currentBreathStep++;

                if (currentBreathStep >= breathSteps.length) {
                    currentBreathStep = 0;

                    const totalCycles = document.getElementById('totalBreathingCycles');
                    totalCycles.textContent = parseInt(totalCycles.textContent) + 1;

                    const breathingCycles = JSON.parse(localStorage.getItem('breathingCycles') || '0');
                    localStorage.setItem('breathingCycles', JSON.stringify(breathingCycles + 1));
                }
            }

            runCycle();
            breathingInterval = setInterval(runCycle, 4000);
        }

        function resetBreathingCycle() {
            if (breathingInterval) {
                clearInterval(breathingInterval);
                breathingInterval = null;
            }

            if (breathingCountdownInterval) {
                clearInterval(breathingCountdownInterval);
                breathingCountdownInterval = null;
            }

            breathSteps.forEach(step => {
                document.getElementById(step).classList.remove('active');
                document.getElementById(`countdown-${step}`).textContent = '';
            });

            document.getElementById('breathingStartBtn').style.display = 'inline-block';
            document.getElementById('breathingResetBtn').style.display = 'none';

            showSuccessMessage('Breathing exercise stopped. Great work! ü´Å');
        }

        // Negative thought detection
        const negativePatterns = [
            'not good enough',
            'fraud',
            "don't deserve",
            'imposter',
            'fake',
            'fake it',
            'everyone else',
            'just lucky',
            "they'll find out",
            'not qualified',
            "can't do",
            'failure',
            'worthless',
            'stupid',
            'incompetent',
            'never succeed',
            'not capable',
            'too difficult',
            "i'm a fake",
            'feel like a fake',
            'feel like an imposter'
        ];

        function detectNegativeThought() {
            const input = document.getElementById('imposterInput').value.toLowerCase();
            const detected = negativePatterns.some(pattern => input.includes(pattern));

            if (detected && input.length > 10) {
                document.getElementById('negativeDetected').style.display = 'block';
                document.getElementById('believabilityBefore').style.display = 'block';
            } else {
                document.getElementById('negativeDetected').style.display = 'none';
                document.getElementById('believabilityBefore').style.display = 'none';
                document.getElementById('counterFacts').style.display = 'none';
            }
        }

        function generateCounterFacts(thought) {
            const lower = thought.toLowerCase();
            const facts = [];

            if (lower.includes('not good enough') || lower.includes('not qualified')) {
                facts.push('Evidence: You maintained 99% data integrity across 10+ years of professional work');
                facts.push("Achievement: You're in the top 5% of Agentforce learners globally");
                facts.push('Skill Validation: You earned 96 Trailhead badges + 2 superbadges through demonstrated competency');
            }

            if (lower.includes("don't deserve") || lower.includes('fraud') || lower.includes('fake') || lower.includes('imposter')) {
                facts.push('Reality Check: You have 13 months of hands-on Actimize experience with measurable results');
                facts.push('Unique Value: Your neurodivergent perspective provides innovative problem-solving approaches');
                facts.push('Dual Expertise: You possess rare combined expertise in both Salesforce and compliance systems');
                facts.push('Using AI Tools: Using AI is a skill, not cheating - it shows you can leverage modern tools effectively');
                facts.push('Industry Reality: Top developers and professionals use AI tools daily - it\'s smart, not fake');
            }

            if (lower.includes('failure') || lower.includes("can't do") || lower.includes('never succeed')) {
                facts.push('Past Success: You have consistently overcome significant challenges throughout your career');
                facts.push('Growth Pattern: Each challenge you faced, you learned and adapted successfully');
                facts.push('Current Progress: You are actively building skills and applying for positions - that is action, not failure');
            }

            if (lower.includes('stupid') || lower.includes('incompetent') || lower.includes('worthless')) {
                facts.push('Objective Truth: Intelligence is not fixed - you continuously learn and grow');
                facts.push('Evidence of Capability: You successfully manage complex technical systems and health conditions simultaneously');
                facts.push('Reality: Your thoughts are not facts - they are influenced by mood, energy, and past experiences');
            }

            if (facts.length === 0) {
                facts.push('Thinking Trap: This is called "all-or-nothing thinking" - reality exists on a spectrum, not extremes');
                facts.push('Evidence: Your past achievements demonstrate capability, regardless of current feelings');
                facts.push('CBT Principle: Negative thoughts are automatic and often distorted - question their validity');
            }

            return facts;
        }

        let believabilityBefore = 0;
        let believabilityAfter = 0;

        function setBelievability(type, value) {
            if (type === 'before') {
                believabilityBefore = value;
                document.querySelectorAll('#scaleBeforeButtons .scale-button').forEach(btn => {
                    btn.classList.remove('selected');
                });
                event.target.classList.add('selected');

                const thought = document.getElementById('imposterInput').value;
                const facts = generateCounterFacts(thought);

                const factsList = document.getElementById('factsList');
                factsList.innerHTML = facts.map(fact => `
                    <div class="fact-item">
                        <span class="fact-icon">‚úì</span>
                        <span>${fact}</span>
                    </div>
                `).join('');

                document.getElementById('counterFacts').style.display = 'block';

            } else {
                believabilityAfter = value;
                document.querySelectorAll('#scaleAfterButtons .scale-button').forEach(btn => {
                    btn.classList.remove('selected');
                });
                event.target.classList.add('selected');

                if (believabilityAfter < believabilityBefore) {
                    const reduction = believabilityBefore - believabilityAfter;
                    showSuccessMessage(`Excellent work! You reduced the thought's power by ${reduction} points! üéâ`);
                } else if (believabilityAfter === believabilityBefore) {
                    alert('The thought still feels the same. That\'s okay - challenging thoughts takes practice. Consider discussing this with your therapist.');
                } else {
                    alert('The thought feels stronger now. This can happen - please reach out to your support system or therapist.');
                }
            }
        }

        function saveImposterSession() {
            const thought = document.getElementById('imposterInput').value;

            if (!believabilityBefore || !believabilityAfter) {
                alert('Please complete both believability ratings (before and after)');
                return;
            }

            const session = {
                thought,
                believabilityBefore,
                believabilityAfter,
                date: new Date().toISOString(),
                reduction: believabilityBefore - believabilityAfter
            };

            const sessions = JSON.parse(localStorage.getItem('imposterSessions') || '[]');
            sessions.push(session);
            localStorage.setItem('imposterSessions', JSON.stringify(sessions));

            document.getElementById('imposterInput').value = '';
            document.getElementById('negativeDetected').style.display = 'none';
            document.getElementById('believabilityBefore').style.display = 'none';
            document.getElementById('counterFacts').style.display = 'none';
            believabilityBefore = 0;
            believabilityAfter = 0;

            document.querySelectorAll('.scale-button').forEach(btn => btn.classList.remove('selected'));

            showSuccessMessage('Session saved! Keep challenging those thoughts! üí™');
            updateDashboard();
        }

        function toggleTherapyTechnique(item, technique) {
            const checkbox = item.querySelector('.checklist-checkbox');
            checkbox.checked = !checkbox.checked;

            if (checkbox.checked) {
                item.classList.add('completed');
            } else {
                item.classList.remove('completed');
            }

            if (checkbox.checked) {
                const techniques = JSON.parse(localStorage.getItem('therapyTechniques') || '{}');
                techniques[technique] = (techniques[technique] || 0) + 1;
                localStorage.setItem('therapyTechniques', JSON.stringify(techniques));

                const counter = document.getElementById(`counter-${technique}`);
                counter.textContent = techniques[technique];

                showSuccessMessage(`Great! You've used ${technique} ${techniques[technique]} times!`);

                setTimeout(() => {
                    checkbox.checked = false;
                    item.classList.remove('completed');
                }, 2000);

                updateDashboard();
            }
        }

        function loadTechniqueCounters() {
            const techniques = JSON.parse(localStorage.getItem('therapyTechniques') || '{}');
            ['grounding', 'thought', 'bottraining'].forEach(tech => {
                const counter = document.getElementById(`counter-${tech}`);
                if (counter) {
                    counter.textContent = techniques[tech] || 0;
                }
            });

            const breathingCycles = JSON.parse(localStorage.getItem('breathingCycles') || '0');
            const breathingCounters = ['breathe-in', 'hold-in', 'breathe-out', 'hold-out'];
            breathingCounters.forEach(step => {
                const counter = document.getElementById(`counter-${step}`);
                if (counter) {
                    counter.textContent = breathingCycles;
                }
            });
            document.getElementById('totalBreathingCycles').textContent = breathingCycles;
        }

        // Quick Actions
        function startGardenBreak() {
            if (confirm('Start 15-minute garden break?')) {
                showSuccessMessage('Enjoy your garden break! Timer set for 15 minutes. üåø');
            }
        }

        // 5:15 PM Boundary Check
        function checkBoundary() {
            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();

            if (hour === 17 && minute >= 15) {
                document.getElementById('boundaryCard').style.display = 'block';
            }
        }

        function acknowledgeBoundary() {
            document.getElementById('boundaryCard').style.display = 'none';
            showSuccessMessage('Great job respecting your boundaries! Starting evening routine...');
            switchTab('routine');
        }

        function showSuccessMessage(message) {
            const existingMsg = document.querySelector('.success-message');
            if (existingMsg) existingMsg.remove();

            const successMsg = document.createElement('div');
            successMsg.className = 'success-message';
            successMsg.textContent = message;
            document.querySelector('.content').insertBefore(successMsg, document.querySelector('.content').firstChild);

            setTimeout(() => {
                successMsg.remove();
            }, 3000);
        }

        setInterval(checkBoundary, 60000);
        checkBoundary();

        // Initialize
        window.addEventListener('load', () => {
            const today = new Date().toISOString().split('T')[0];

            const gratitudes = JSON.parse(localStorage.getItem('gratitudes') || '{}');
            if (gratitudes[today]) {
                const gratitudeList = document.getElementById('gratitudeList');
                gratitudes[today].forEach(entry => {
                    const div = document.createElement('div');
                    div.className = 'gratitude-entry';
                    div.innerHTML = `
                        <div class="gratitude-text">${entry.text}</div>
                        <div class="gratitude-time">${entry.time}</div>
                    `;
                    gratitudeList.appendChild(div);
                });
            }

            const moods = JSON.parse(localStorage.getItem('moods') || '{}');
            if (moods[today]) {
                ['morning', 'midday', 'evening'].forEach(time => {
                    if (moods[today][time]) {
                        const element = document.getElementById(`${time}Mood`);
                        element.classList.add('completed');
                        element.querySelector('.mood-value').textContent =
                            `Mood: ${moods[today][time].mood}, Energy: ${moods[today][time].energy}`;
                    }
                });
            }

            loadTechniqueCounters();
            loadJournalEntries();
            loadMealHistory();
            updateDashboard();
        });
    </script>
</body>
</html>
